<!DOCTYPE html>
<html>
 
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
 
    <title>Checkout</title>
 
    <link rel="stylesheet" href="">
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- Bootstrap libraries -->
    <meta name="viewport" 
        content="width=device-width, initial-scale=1, shrink-to-fit=no">
 
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
    integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" 
    crossorigin="anonymous">
 
    <!-- Latest compiled and minified JavaScript -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script 
    src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    
    <script
    src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
    integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
    crossorigin="anonymous"></script>
    
    <script 
    src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
    integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
    crossorigin="anonymous"></script>
</head>

<body>

    <h1>Checkout</h1>

        <table id="Particulars" class='table table-striped'>
            <tr>
                <th>Name</th>
                <th>Email 13</th>
                <th>Quantity</th>
                <th>Address</th>
                <th>Phone</th>
                <th>Postal Code</th>
            </tr>  
        </table>

        <table id="PaymentDetails" class='table table-striped'>
            <tr>
                <th>Food Item</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Delivery</th>
                <th>Subtotal</th>
            </tr>  
        </table>

        <label id="error" class="text-danger"></label>

        <script>
        // Helper function to display error message


        $('#Particulars').hide();
        $('#PaymentDetails').hide();

        function showError(message) {
            // Hide the table and button in the event of error
            $('#Particulars').hide();
            $('#PaymentDetails').hide();            
        }
        
        $(function() {        
        $("#orderForm").submit(async (event) =>{
        event.preventDefault();
        //$("#error").hide(); 

        var name = $('#name').val();
        var email = $('#email').val();
        var quantity = parseInt($('#quantity').val());
        var address = $('#address').val();
        var phone = parseInt($('#phone').val());
        var postalCode = parseInt($('#postalCode').val());


        serviceURL = "http://127.0.0.1:5000/order";

        try{
            const response = 
                await fetch(
                    serviceURL,{
                    method : "POST",
                    headers: {"Content-Type":"application/json"},
                    body: JSON.stringify ({name:name, email:email, quantity:quantity,
                        address:address, phone:phone, postalCode:postalCode})
                });
        const data = await response.json();
        if (response.ok){
            window.location.replace(homeURL);
            return false;
            
        }
        else{
            console.log(data)
            particulars = 
            "<tbody>" +
            "<tr>" +
            "<td>" + name + "</td>" + 
            "<td>" + email + "</td>" +
            "<td>" + quantity+ "</td>" +
            "<td>" + address + "</td>" +
            "<td>" + phone + "</td>" +
            "<td>" + postalCode + "</td>" +
            "</tr>" +
            "</body>"
            $("#Particulars").append( particulars );
            showError(data.message);
            $("#Particulars").show();
        }
        }
        catch (error){
            showError
            ('There is a problem retrieving your order particulars, please try again later.<br />'+error);
                }        
        })
        }
        );
    </script>

</body>
</html>